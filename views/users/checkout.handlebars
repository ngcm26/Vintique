{{!< user}}

<div class="container mt-4">
  <div class="row">
    <div class="col-lg-8">
      <div class="card shadow-sm">
        <div class="card-header bg-primary text-white">
          <h4 class="mb-0">
            <i class="fas fa-shopping-cart me-2"></i>Checkout
          </h4>
        </div>
        <div class="card-body">
          <h5 class="card-title mb-4">Order Summary</h5>
          
          {{#each cartItems}}
          <div class="row mb-3 p-3 border rounded">
            <div class="col-md-2">
              {{#if image_url}}
                <img src="{{image_url}}" alt="{{title}}" class="img-fluid rounded" style="width: 80px; height: 80px; object-fit: cover;">
              {{else}}
                <img src="/assets/logo.png" alt="{{title}}" class="img-fluid rounded" style="width: 80px; height: 80px; object-fit: cover;">
              {{/if}}
            </div>
            <div class="col-md-6">
              <h6 class="mb-1">{{title}}</h6>
              <p class="text-muted mb-1">Category: {{category}}</p>
              <p class="text-muted mb-0">Condition: {{capitalize item_condition}}</p>
              <small class="text-muted">Seller: @{{seller_username}}</small>
            </div>
            <div class="col-md-4 text-end">
              <h5 class="text-primary mb-0">${{price}}</h5>
            </div>
          </div>
          {{/each}}
          
          <hr>
          
          <div class="row">
            <div class="col-md-6">
              <h5>Shipping Information</h5>
              <form id="checkoutForm">
                <div class="mb-3">
                  <label for="shipping_address" class="form-label">Shipping Address</label>
                  <textarea class="form-control" id="shipping_address" name="shipping_address" rows="3" required></textarea>
                </div>
                
                <div class="mb-3">
                  <label for="payment_method" class="form-label">Payment Method</label>
                  <select class="form-select" id="payment_method" name="payment_method" required>
                    <option value="">Select payment method</option>
                    <option value="credit_card">Credit Card</option>
                    <option value="paypal">PayPal</option>
                    <option value="bank_transfer">Bank Transfer</option>
                  </select>
                </div>
              </form>
            </div>
            
            <div class="col-md-6">
              <div class="card bg-light">
                <div class="card-body">
                  <h5 class="card-title">Order Total</h5>
                  <div class="d-flex justify-content-between mb-2">
                    <span>Subtotal:</span>
                    <span>${{total}}</span>
                  </div>
                  <div class="d-flex justify-content-between mb-2">
                    <span>Shipping:</span>
                    <span>$5.00</span>
                  </div>
                  <hr>
                  <div class="d-flex justify-content-between">
                    <strong>Total:</strong>
                    <strong class="text-primary">${{add total 5}}</strong>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
    
    <div class="col-lg-4">
      <div class="card shadow-sm">
        <div class="card-header bg-success text-white">
          <h5 class="mb-0">
            <i class="fas fa-lock me-2"></i>Secure Checkout
          </h5>
        </div>
        <div class="card-body">
          <p class="text-muted mb-3">
            Your payment information is encrypted and secure. We never store your payment details.
          </p>
          
          <button class="btn btn-primary btn-lg w-100 mb-3" onclick="processCheckout()">
            <i class="fas fa-credit-card me-2"></i>Complete Purchase
          </button>
          
          <div class="text-center">
            <small class="text-muted">
              By completing your purchase, you agree to our Terms of Service and Privacy Policy.
            </small>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<script>
function processCheckout() {
  const form = document.getElementById('checkoutForm');
  const formData = new FormData(form);
  
  fetch('/checkout/process', {
    method: 'POST',
    headers: {
      'Content-Type': 'application/json',
    },
    body: JSON.stringify({
      payment_method: formData.get('payment_method'),
      shipping_address: formData.get('shipping_address')
    })
  })
  .then(response => response.json())
  .then(data => {
    if (data.success) {
      window.location.href = '/checkout/success';
    } else {
      alert('Error: ' + data.error);
    }
  })
  .catch(error => {
    console.error('Error:', error);
    alert('An error occurred during checkout. Please try again.');
  });
}
</script> 